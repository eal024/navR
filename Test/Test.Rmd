---
title: "Kapittel XXXX"
author: "Her skriver du navn."
date: "01 10 2020"
output: pdf_document
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
# Nødvendige pakker

knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(navR)
library(kableExtra)

```

```{r forutsetninger, echo = F}


# Data og forutsetninger
regnskap <- navR::regnskap %>% filter( dato < lubridate::ymd("2021-09-01")) %>% arrange( desc(dato))
mottakere <- navR::mottakere %>% filter( dato < lubridate::ymd("2021-09-01"))%>% arrange( desc(dato))

# Pris
g_20 <- 100853
g_21 <- 103072

```


```{r budsjettobjektet, include= F }

# Budsjettet
bud <- navR::Budsjett$new(     name = "Kap. 2020 Enslig mor eller far",
                               name_nytt_anslag = "oktober 2021",
                               periode = 202108,
                               dfRegnskap = regnskap  %>%  rename( pris = g),
                               dfMottakere =  mottakere  %>% mutate(kategori = "post70"),
                               pris_gjeldende = g_20,
                               PRIS_VEKST = (104514/98866)
                          )
```

```{r 2020-anslaget, include = F }

regnskap_ifjor <- 
  navR::Anslag$new(
        name = str_c("Regnskap " ),
        ar = lubridate::year(bud$giPeriode())-1,
        regnskap_ifjor = bud$giRegnskapstall( ar_til_bake = 2),
        volumvekst = (1 - 0.029),
        vekst_ytelse = (1-0.014),
        prisvekst = 1.020,
        tiltak = (1 - 0.0)
    )


forrige_iar <-
    navR::Anslag$new(
        name = "Anslag fra 21.7.21",
        ar = 2021,
        regnskap_ifjor = bud$giRegnskapstallIfjor(),
        volumvekst = (1 - 0.00),
        vekst_ytelse = (1-0.015),
        prisvekst = 1.0383,
        tiltak = (1 - 0.0229)
    )

vedtatt_iar <-
    navR::Anslag$new(
        name = "Anslag fra 21.3.21",
        ar = 2021,
        regnskap_ifjor = bud$giRegnskapstallIfjor(),
        volumvekst = (1 + 0.0069),
        vekst_ytelse = (1-0.005),
        prisvekst = 1.0393,
        tiltak = (1 - 0.02187)
    )

nytt_iar <-
    navR::Anslag$new(
        name = "NAVs nye anslag",
        ar = 2021, #(bud$giAr()+1)
        regnskap_ifjor = bud$giRegnskapstallIfjor(),
        volumvekst = (1 + 0.015),
        vekst_ytelse = (1-0.026),
        prisvekst = 1.0383,
        tiltak = (1 - 0.0222)
    )

nytt_neste_ar <-
    navR::Anslag$new(
        name = "NAVs nye anslag 2022",
        ar = 2022,
        regnskap_ifjor = nytt_iar$giSumAnslag(),
        volumvekst = (1 - 0.005),
        vekst_ytelse = (1-0.00),
        prisvekst = 1.0341,
        tiltak = (1 - 0.0145)
    )

forrige_neste_ar <-
    navR::Anslag$new(
        name = "NAVs forrige anslag for 2022",
        ar = 2022,
        regnskap_ifjor = forrige_iar$giSumAnslag(),
        volumvekst = (1 - 0.0),
        vekst_ytelse = (1-0.00),
        prisvekst = 1.0341,
        tiltak = (1 - 0.0145)
    )


```

```{r tabell1, echo = F}

tabell1 <- tibble( name  = c("Vedtatt budsjett", forrige2020$giAnslagNavn(), nytt2020$giAnslagNavn(), "Endring fra vedtatt budjsett" ),
        value = c(forrige2020$giSumAnslag(), forrige2020$giSumAnslag(), nytt2020$giSumAnslag(), nytt2020$giSumAnslag() - forrige2020$giSumAnslag()) 
        ) %>% 
    mutate( value = value/10^6 %>% round( digits = 0) ) %>% 
    pivot_wider( names_from = name, values_from = value)

# Regnskapstabell
 %>% %>% %>% %>% %>%  <- bud$lagRegnskapTabell2( anslag1 = nytt2020 ,
                                   anslag2 = nytt2021      ) %>%
    mutate_at( vars( regnskap , endring_regnskap, regnskap_fast, endring_regnskap_f ), function(x) {x/10^6}
               ) %>%
    mutate_at( vars(regnskap,  regnskap_fast) , function(x) ifelse(.$kategori == "Anslag", round(x, -1), x))

```


```{r utrgning månedsutvikling, echo = F}

tabell3 <- bud$lagTabellMndUtviklingRegnskap()


tabell3 <- tabell3 %>%
    mutate( lengde = str_c("mnd ", lengde)) %>% 
    mutate_if( is.numeric, function(x) ifelse( abs(x) > 1, round(x/10^6, digits = 0) %>% format( big.mark = " "), round(x, digits = 4 )*100 )) %>% 
    select(-forrige, -naa)

names(tabell3) <- c(
    "Antall mnd",
    "Prosentvis vekst i \nregnskapstallene målt i fast G",
    "Budsjettanslag for 2020 basert på\ntilsvarende vekst. Mill. kroner",
    "Budsjettanslag for 2021 basert på\ntilsvarende vekst. Mill. kroner"
)


```



## Post xx - beskrivelse av anslagene 
```{r , echo = F }
knitr::kable(format = "latex",booktabs = T, escape = F, 
             tabell1, 
             digits = 0 )%>% 
    kable_styling( latex_options = c("HOLD_position","striped"), stripe_index =  c(1) ) 

```

Arbeids- og velferdsdirektoratet tilrår et anslag for 2020 på `r round( nytt2020$giSumAnslag()/10^6 , digits = 0) %>% format( big.mark = " " )` mill. kroner.
Dette er 36 mill. kroner lavere enn forrige anslag og vedtatt budsjett. For 2021 tilrås et anslag på `r round( nytt2021$giSumAnslag()/10^6 , digits = 0) %>% format( big.mark = " " )` mill. kroner. 

De nye anslagene er basert på august-tall.


### 1.2 Regnskapsutvikling

```{r, echo = F}

knitr::kable( format = "latex", booktabs = T, escape = F,
              tabell2 %>% mutate_if( is.numeric, function(x){ ifelse(abs(x) > 1, round( x, digits = 0), round(x, digits = 2)) }) %>% 
                  rename( Endring = endring_regnskap,
                          vekst   = regnskap_vekst,
                          `Mill. kr i 2020-G` = regnskap_fast,
                          `Endring regnskap i 2020-G`  = endring_regnskap_f,
                          `vekst faste kr` = regnskap_fast_vekst
                          )
                  ) %>% 
    kable_styling( latex_options = c("HOLD_position","striped", "scale_down"), stripe_index =  c(1,3,5,7,9) )  
```




Her skal det være beskrivende tekst for anslaget.

Her kommer tabellen som viser månedsutvikling.
\newpage
```{r utprint regnskappermnd, echo = F, warning=F}


tabell3 %>%
   mutate_all(linebreak) %>%
   kable(format = "latex", booktabs = T, escape = F,
      col.names = linebreak( names(tabell3) ), align = "c" ) %>% 
    kable_styling( latex_options = c("striped", "scale_down"), stripe_index =  c(1,3,5,7,9,11) )  


# knitr::kable("latex",booktabs = T, escape = F, tabell3,  col.names = linebreak( c("Item\n(Name)", "Value\n(Number)", "En", "To"), align = "c"),align = "c")  


# kbl( tabell3 , booktabs = T, linesep = "" , caption = "Dette er tabellen som viser regnskapsutvikling, 3 til 12 måned\nsammenliknet med fjoråret.",
#     col.names = linebreak(c("Item\n(Name)", "Value\n(Number)","Value\n(Number)","Value\n(Number)"), align = "c") ) %>% 
#     kable_styling( latex_options = c("striped"), stripe_index =  c(1,3) )    

```


### 1.3	Forutsetninger og anslag


